# Apache Virtual Host Configuration for LivroLog Production Docker
# Location: /opt/bitnami/apache2/conf/vhosts/livrolog.conf
# Requires modules: proxy proxy_http headers rewrite

<VirtualHost *:80>
    ServerName livrolog.com
    ServerAlias www.livrolog.com
    
    # Security headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Enable proxy module features
    ProxyPreserveHost On
    ProxyRequests Off
    
    # API endpoints - proxy to Laravel container
    ProxyPass /api/ http://127.0.0.1:18081/
    ProxyPassReverse /api/ http://127.0.0.1:18081/
    
    # Health check endpoint (direct from API)
    ProxyPass /health http://127.0.0.1:18081/health
    ProxyPassReverse /health http://127.0.0.1:18081/health
    
    # Documentation endpoint (direct from API)  
    ProxyPass /documentation http://127.0.0.1:18081/documentation
    ProxyPassReverse /documentation http://127.0.0.1:18081/documentation
    
    # Storage/uploads (direct from API)
    ProxyPass /storage/ http://127.0.0.1:18081/storage/
    ProxyPassReverse /storage/ http://127.0.0.1:18081/storage/
    
    # Frontend - proxy to Vue.js container (catch-all)
    ProxyPass / http://127.0.0.1:18080/
    ProxyPassReverse / http://127.0.0.1:18080/
    
    # Proxy timeout settings
    ProxyTimeout 30
    ProxySet connectiontimeout 5
    
    # Logging
    ErrorLog /opt/bitnami/apache2/logs/livrolog_error.log
    CustomLog /opt/bitnami/apache2/logs/livrolog_access.log combined
</VirtualHost>

<VirtualHost *:443>
    ServerName livrolog.com
    ServerAlias www.livrolog.com
    
    # SSL Configuration (adjust paths as needed)
    SSLEngine on
    SSLCertificateFile /opt/bitnami/apache2/conf/server.crt
    SSLCertificateKeyFile /opt/bitnami/apache2/conf/server.key
    
    # Security headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    
    # Enable proxy module features
    ProxyPreserveHost On
    ProxyRequests Off
    
    # API endpoints - proxy to Laravel container
    ProxyPass /api/ http://127.0.0.1:18081/
    ProxyPassReverse /api/ http://127.0.0.1:18081/
    
    # Health check endpoint (direct from API)
    ProxyPass /health http://127.0.0.1:18081/health
    ProxyPassReverse /health http://127.0.0.1:18081/health
    
    # Documentation endpoint (direct from API)
    ProxyPass /documentation http://127.0.0.1:18081/documentation
    ProxyPassReverse /documentation http://127.0.0.1:18081/documentation
    
    # Storage/uploads (direct from API)
    ProxyPass /storage/ http://127.0.0.1:18081/storage/
    ProxyPassReverse /storage/ http://127.0.0.1:18081/storage/
    
    # Frontend - proxy to Vue.js container (catch-all)
    ProxyPass / http://127.0.0.1:18080/
    ProxyPassReverse / http://127.0.0.1:18080/
    
    # Proxy timeout settings
    ProxyTimeout 30
    ProxySet connectiontimeout 5
    
    # Logging
    ErrorLog /opt/bitnami/apache2/logs/livrolog_ssl_error.log
    CustomLog /opt/bitnami/apache2/logs/livrolog_ssl_access.log combined
</VirtualHost>